using HarmonyLib;
using TaleWorlds.CampaignSystem;
using TaleWorlds.CampaignSystem.Inventory;
using TaleWorlds.CampaignSystem.Party;
using TaleWorlds.CampaignSystem.Roster;

namespace PartyAIControls.HarmonyPatches
{
  [HarmonyPatch]
  internal class PreventDonationExploit
  {
    [HarmonyPostfix]
    [HarmonyPatch(typeof(InventoryLogic), "IsDiscardDonating", MethodType.Getter)]
    private static void patch1(InventoryLogic __instance, ref bool __result)
    {
      if (__instance?.LeftMemberRoster == null) { return; }
      PartyBase owner = (PartyBase)AccessTools.Property(typeof(TroopRoster), "OwnerParty").GetValue(__instance.LeftMemberRoster);
      if (owner?.MobileParty?.ActualClan == Clan.PlayerClan)
      {
        __result = false;
      }
    }
  }
}
