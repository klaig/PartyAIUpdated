<Prefab>
  <Constants>
  </Constants>
  <Parameters>
    <Parameter Name="DataSource" DefaultValue="" />
  </Parameters>
  <Window>
	<Widget DataSource="*DataSource" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" HorizontalAlignment="Center" VerticalAlignment="Center" Sprite="BlankWhiteSquare_9" Color="#000000FF" AlphaFactor="0.75">
	  <Children>
		<DimensionSyncWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="650" DimensionToSync="Vertical" HorizontalAlignment="Center" VerticalAlignment="Center" WidgetToCopyHeightFrom="InnerPanel">
		  <Children>
			<Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" ClipContents="true">
			  <Children>
				<Widget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" HorizontalAlignment="Center" VerticalAlignment="Top" Sprite="StdAssets\Popup\canvas" />
			  </Children>
			</Widget>
			<ListPanel Id="InnerPanel" WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalBottomToTop" MarginLeft="15" MarginRight="15">
			  <Children>
				<ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="VerticalBottomToTop" MarginBottom="5">
				  <Children>
					<!--Title-->
					<AutoHideRichTextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" MarginTop="10" Brush="Popup.Title.Text" MinHeight="50" Text="@TitleText" WidgetToHideIfEmpty="..\TitleDivider" />
					<!--Divider-->
					<Widget Id="TitleDivider" WidthSizePolicy="StretchToParent" HeightSizePolicy="Fixed" SuggestedHeight="23" Sprite="StdAssets\Popup\divider" />
				  </Children>
				</ListPanel>

				<ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="HorizontalLeftToRight">
					<Children>
						<!-- Troop Conversion Header -->
						<TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Brush="PartyAI.Menu.PartyRowText" VerticalAlignment="Center" Brush.TextHorizontalAlignment="Left" MarginLeft="14" Text="@TroopConversionHeader">
							<Children>
								<HintWidget DataSource="{TroopConversionHeaderHint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" IsDisabled="false" />
							</Children>
						</TextWidget>
					
						<!-- Troops Converted Per Day Text -->
						<TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Brush="Clan.Stat.Name.Text" VerticalAlignment="Center" Brush.TextHorizontalAlignment="Right" MarginTop="4" Text="@TroopsConvertedPerDayText">
							<Children>
								<HintWidget DataSource="{TroopsConvertedPerDayHint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" IsDisabled="false" />
							</Children>
						</TextWidget>
						
						<!-- Troops Converted Per Day Amount -->
						<TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginLeft="5" Brush="PartyAI.Menu.PartyRowText" VerticalAlignment="Center" Brush.TextHorizontalAlignment="Left" Text="@TroopsConvertedPerDayAmount"/>
						
						<!-- Edit Troops Converted Per Day -->
						<ButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="30" SuggestedHeight="30" VerticalAlignment="Center" MarginLeft="8" UpdateChildrenStates="true" Command.Click='EditTroopsConvertedPerDay'>
						  <Children>
							<HintWidget DataSource="{ChangeHint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" />
							<BrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="34" SuggestedHeight="34" HorizontalAlignment="Right" VerticalAlignment="Center" Brush="PartyAI.Menu.EditButton" />
						  </Children>
						</ButtonWidget>
					</Children>
				</ListPanel>
				
				<!-- Troop Conversion Toggles -->
				<ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="HorizontalLeftToRight" MarginBottom="30">
					<Children>
						<PartyAIOptionToggle Parameter.DataSource="{AllowTroopConversionToggle}" MarginLeft="10" />
						<PartyAIOptionToggle Parameter.DataSource="{AllowTroopConversionForCaravansToggle}" />
						<PartyAIOptionToggle Parameter.DataSource="{AllowTroopConversionForGarrisonsToggle}" />
					</Children>
				</ListPanel>
				
				<!-- Management Header -->
				<TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Brush="PartyAI.Menu.PartyRowText" VerticalAlignment="Center" Brush.TextHorizontalAlignment="Left" MarginLeft="14" Text="@ManagementHeader">
					<Children>
						<HintWidget DataSource="{ManagementHeaderHint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" IsDisabled="false" />
					</Children>
				</TextWidget>

				<!-- Management Toggles -->
				<ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="HorizontalLeftToRight">
					<Children>
						<PartyAIOptionToggle Parameter.DataSource="{ManageCaravansToggle}" MarginLeft="10" />
						<PartyAIOptionToggle Parameter.DataSource="{ManageKingdomPartiesToggle}" MarginLeft="48"  />
					</Children>
				</ListPanel>
				<ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="HorizontalLeftToRight" MarginBottom="30">
					<Children>
						<PartyAIOptionToggle Parameter.DataSource="{ManageClanGarrisonsToggle}" MarginLeft="10" />
						<PartyAIOptionToggle Parameter.DataSource="{ManageKingdomGarrisonsToggle}" />
					</Children>
				</ListPanel>

				<!-- AI Tweaks Header -->
				<TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Brush="PartyAI.Menu.PartyRowText" VerticalAlignment="Center" Brush.TextHorizontalAlignment="Left" MarginLeft="14" Text="@AITweaksHeader" />

				<!-- AI Tweaks Toggles -->
				<ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="HorizontalLeftToRight" MarginBottom="30">
					<Children>
						<PartyAIOptionToggle Parameter.DataSource="{AggressivePatrolsToggle}" MarginLeft="10" />
						<PartyAIOptionToggle Parameter.DataSource="{AIRecruitCulture}" IsVisible="False" />
						<ButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="30" SuggestedHeight="30" VerticalAlignment="Center" MarginLeft="8" UpdateChildrenStates="true" Command.Click='OpenCulturalTroopsEditor' IsVisible="False">
						  <Children>
							<HintWidget DataSource="{ChangeHint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" />
							<BrushWidget WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="34" SuggestedHeight="34" HorizontalAlignment="Right" VerticalAlignment="Center" Brush="PartyAI.Menu.EditButton" />
						  </Children>
						</ButtonWidget>
					</Children>
				</ListPanel>
				
				<!-- Keybinds Header -->
				<TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Brush="PartyAI.Menu.PartyRowText" VerticalAlignment="Center" Brush.TextHorizontalAlignment="Left" MarginLeft="14" Text="@KeybindsHeader" />
				
				<!-- Control Panel Key Selector -->
				<ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginTop="5" MarginLeft="23" StackLayout.LayoutMethod="HorizontalLeftToRight">
					<Children>
						<TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="CoverChildren" SuggestedWidth="180" Brush="Clan.Stat.Name.Text" VerticalAlignment="Center" Brush.TextHorizontalAlignment="Left" Text="@ControlPanelKeySelectorText" >
							<Children>
								<HintWidget DataSource="{ControlPanelKeySelectorHint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" IsDisabled="false" />
							</Children>
						</TextWidget>
						<PartyAIKeySelector Parameter.DataSource="{ControlPanelKeySelector}" />
					</Children>
				</ListPanel>
				
				<!-- Select Commanded Parties Key Selector -->
				<ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginTop="5" MarginLeft="23" StackLayout.LayoutMethod="HorizontalLeftToRight">
					<Children>
						<TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="CoverChildren" SuggestedWidth="180" Brush="Clan.Stat.Name.Text" VerticalAlignment="Center" Brush.TextHorizontalAlignment="Left" Text="@CommandedPartiesKeySelectorText" >
							<Children>
								<HintWidget DataSource="{CommandedPartiesKeySelectorHint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" IsDisabled="false" />
							</Children>
						</TextWidget>
						<PartyAIKeySelector Parameter.DataSource="{CommandedPartiesKeySelector}" />
					</Children>
				</ListPanel>
				
				<!-- Command Parties Key Selector -->
				<ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" MarginTop="5" MarginLeft="23" StackLayout.LayoutMethod="HorizontalLeftToRight">
					<Children>
						<TextWidget WidthSizePolicy="Fixed" HeightSizePolicy="CoverChildren" SuggestedWidth="180" Brush="Clan.Stat.Name.Text" VerticalAlignment="Center" Brush.TextHorizontalAlignment="Left" Text="@CommandPartiesKeySelectorText" >
							<Children>
								<HintWidget DataSource="{CommandPartiesKeySelectorHint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" IsDisabled="false" />
							</Children>
						</TextWidget>
						<PartyAIKeySelector Parameter.DataSource="{CommandPartiesKeySelector}" />
					</Children>
				</ListPanel>
				
				<!-- Auto Create Clan Parties -->
				<PartyAIOptionToggle Parameter.DataSource="{AutoCreateClanPartiesToggle}" MarginTop="30" />
				
				<!-- Max Parties -->
				<ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="HorizontalLeftToRight" MarginTop="5" MarginLeft="13">
					<Children>
						<TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" VerticalAlignment="Bottom" Brush="Clan.Stat.Name.Text" Text="@PartyLimitText">
							<Children>
								<HintWidget DataSource="{AutoCreateClanPartiesMaxHint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" IsDisabled="false" />
							</Children>
						</TextWidget>
						<PartyAIDropdown Parameter.DataSource="{AutoCreateClanPartiesMaxController}" WidthSizePolicy="Fixed" SuggestedWidth="45" UpdateChildrenStates='true' MarginLeft="25" VerticalAlignment="Center" />
					</Children>
				</ListPanel>
				
				<!-- Leader Roster -->
				<ListPanel WidthSizePolicy="StretchToParent" HeightSizePolicy="CoverChildren" StackLayout.LayoutMethod="HorizontalLeftToRight" MarginTop="5" MarginLeft="13">
					<Children>
						<!-- Text -->
						<TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" VerticalAlignment="Bottom" Brush="Clan.Stat.Name.Text" Text="@LeaderRosterText">
							<Children>
								<HintWidget DataSource="{LeaderRosterTextHint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" />
							</Children>
						</TextWidget>
						
						<!-- Portraits -->
						<ListPanel DataSource="{LeaderRoster}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" VerticalAlignment="Center" MarginLeft="8" StackLayout.LayoutMethod="HorizontalLeftToRight">
							<ItemTemplate>
								<!-- I have no idea why this listpanel is needed but it took me an hour to figure out it was necessary (╯°□°）╯︵ ┻━┻ -->
								<ListPanel WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedHeight="26" SuggestedWidth="36" MarginLeft="0" StackLayout.LayoutMethod="HorizontalLeftToRight">
									<Children>
										<ImageIdentifierWidget DataSource="{Visual}" WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" AdditionalArgs="@AdditionalArgs" ImageId="@Id" ImageTypeCode="@ImageTypeCode">
											<Children>
												<HintWidget DataSource="{..\Hint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" />
											</Children>
										</ImageIdentifierWidget>
									</Children>
								</ListPanel>
							</ItemTemplate>
						</ListPanel>
						
						<!-- Hidden Leaders -->
						<TextWidget WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Left" VerticalAlignment="Bottom" Brush="PartyAI.Menu.PartyRowText" Text="@LeaderRosterHiddenText">
							<Children>
								<HintWidget DataSource="{LeaderRosterHiddenHint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" />
							</Children>
						</TextWidget>

						<!-- Change Hero Roster -->
						<ButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="34" SuggestedHeight="34" MarginLeft="10" UpdateChildrenStates="true" Command.Click='ChangeHeroRoster'>
						  <Children>
							<HintWidget DataSource="{ChangeHeroRosterHint}" WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" Command.HoverBegin="ExecuteBeginHint" Command.HoverEnd="ExecuteEndHint" />
							<BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" HorizontalAlignment="Right" VerticalAlignment="Center" Brush="PartyAI.Menu.EditButton" />
						  </Children>
						</ButtonWidget>
					</Children>
				</ListPanel>

				<ListPanel WidthSizePolicy="CoverChildren" HeightSizePolicy="CoverChildren" HorizontalAlignment="Center" MarginTop="20" StackLayout.LayoutMethod="HorizontalLeftToRight">
				  <Children>
					<ToggleButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="251" SuggestedHeight="64" HorizontalAlignment="Right" VerticalAlignment="Center" Brush="Popup.Cancel.Button" Command.Click="CancelEditModOptions" GamepadNavigationIndex="0">
					  <Children>
						<TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Popup.Button.Text" Text="@CancelText" MarginLeft="40" MarginRight="40"/>
					  </Children>
					</ToggleButtonWidget>
					<ToggleButtonWidget DoNotPassEventsToChildren="true" WidthSizePolicy="Fixed" HeightSizePolicy="Fixed" SuggestedWidth="251" SuggestedHeight="64" HorizontalAlignment="Right" VerticalAlignment="Center" Brush="Popup.Done.Button" Command.Click="AcceptEditModOptions" GamepadNavigationIndex="1">
					  <Children>
						<TextWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Popup.Button.Text" Text="@AcceptText" MarginLeft="40" MarginRight="40"/>
					  </Children>
					</ToggleButtonWidget>
				  </Children>
				</ListPanel>
			  </Children>
			</ListPanel>
			<!--Frame Border-->
			<BrushWidget WidthSizePolicy="StretchToParent" HeightSizePolicy="StretchToParent" Brush="Popup.Frame" IsEnabled="false" />
		  </Children>
		</DimensionSyncWidget>
	  </Children>
	</Widget>
  </Window>
</Prefab>
